services:
  db:
    image: postgres:18.1-alpine3.23
    container_name: postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: ${PG_DB}
      POSTGRES_USER: ${PG_USER}
      POSTGRES_PASSWORD: ${PG_PASSWORD}
    ports:
      - "${PG_PORT}:5432"
    volumes:
      - pg-data:/var/lib/postgresql/data

  elasticsearch:
      image: elasticsearch:9.3.0
      container_name: elasticsearch
      restart: on-failure
      environment:
        discovery.type: single-node
        xpack.security.enabled: false # Disable security for local development
        ES_JAVA_OPTS: -Xms512m -Xmx512m
      ports:
        - "${EL_PORT}:9200"
      volumes:
        - es_data:/usr/share/elasticsearch/data
      networks:
        - elk-network


  logstash:
      image: logstash:9.3.0
      container_name: logstash
      restart: on-failure
      platform: linux/amd64
      depends_on:
        - elasticsearch
      environment:
        LS_JAVA_OPTS: -Xms256m -Xmx256m
      ports:
        - "${LS_PORT}:5044"
      volumes:
        - ./logstash/pipeline:/usr/share/logstash/pipeline
      networks:
        - elk-network

  kibana:
    image: kibana:9.3.0
    container_name: kibana
    restart: on-failure
    depends_on:
      - elasticsearch
    environment:
      ELASTICSEARCH_HOSTS: http://elasticsearch:9200
    ports:
      - "${KB_PORT}:5601"
    networks:
      - elk-network

volumes:
  pg-data:
  es_data:

networks:
  elk-network:


